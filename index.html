<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OTP Login via Brevo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #1f2937; }
    .glass {
      background: rgba(31, 41, 55, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
    }
    .transition-input:focus {
      border-color: #dc2626;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.3);
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center text-white px-4">

  <div class="glass max-w-md w-full p-8 space-y-6">
    <h2 class="text-2xl font-bold text-center">üîê Secure Email Login</h2>

    <div>
      <label for="email" class="block text-sm mb-1">Email Address</label>
      <input type="email" id="email" placeholder="you@example.com"
             class="w-full px-4 py-2 border border-gray-600 rounded-md text-black font-bold focus:outline-none transition-input"/>
    </div>

    <div>
      <label for="otp" class="block text-sm mb-1">OTP</label>
      <div class="flex gap-2">
        <input type="number" id="otp" placeholder="Enter OTP" inputmode="numeric"
               class="flex-1 px-4 py-2 border border-gray-600 rounded-md text-black font-bold focus:outline-none transition-input"/>
        <button id="otpBtn" onclick="sendOTP()"
                class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition">
          Get OTP
        </button>
      </div>
    </div>

    <button id="submitBtn" onclick="verifyOTP()" disabled
            class="w-full py-2 bg-green-600 rounded-md hover:bg-green-700 transition disabled:opacity-50 disabled:cursor-not-allowed">
      Submit
    </button>

    <div id="message" class="mt-4 text-center text-sm font-medium hidden"></div>
  </div>

  <script>
    const emailInput = document.getElementById("email");
    const otpInput = document.getElementById("otp");
    const submitBtn = document.getElementById("submitBtn");
    const otpBtn = document.getElementById("otpBtn");
    const messageEl = document.getElementById("message");

    let generatedOTP = "";
    let otpTimestamp = null;
    let isCooldown = false;
    const cooldownTime = 30 * 1000;
    const otpValidityTime = 60 * 1000;

    [emailInput, otpInput].forEach(input => {
      input.addEventListener("input", () => {
        submitBtn.disabled = !(emailInput.value.trim() && otpInput.value.trim());
      });
    });

    function sendOTP() {
      const email = emailInput.value.trim();
      if (!email) return showMessage("‚ùå Please enter your email", "text-red-500");
      if (isCooldown) return;

      if (!generatedOTP) {
        generatedOTP = Math.floor(10000 + Math.random() * 90000).toString();
        otpTimestamp = Date.now();
      }

      const data = {
        sender: { name: "Kunal Dixit", email: "kunaldixit.233860@gmail.com" },
        to: [{ email: email }],
        subject: "Your OTP Code",
        htmlContent: `<p>Dear User, <br><br> Your One-Time Password (OTP) is: <strong>${generatedOTP}</strong>. <br><br><br> It is valid for 1 minute.<br><br><br>Please do not share this code with anyone.<br><br><br>If you did not request this OTP, please ignore this email.<br><br><br>Thank you,<br><br>Kunal's Portal Team</p>`
      };

      showMessage("üì§ Sending OTP...", "text-gray-300");

      fetch("https://api.brevo.com/v3/smtp/email", {
        method: "POST",
        headers: {
          accept: "application/json",
          "content-type": "application/json",
          "api-key": "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"
        },
        body: JSON.stringify(data)
      })
      .then(res => {
        if (!res.ok) throw new Error("Failed");
        showMessage("‚úÖ OTP sent! You can resend after 30s", "text-green-500");
        startCooldown();
      })
      .catch(err => {
        console.error(err);
        showMessage("‚ùå Failed to send OTP", "text-red-500");
      });
    }

    function startCooldown() {
      isCooldown = true;
      let remaining = 30;
      otpBtn.disabled = true;
      otpBtn.textContent = `Wait (${remaining}s)`;

      const interval = setInterval(() => {
        remaining--;
        otpBtn.textContent = `Wait (${remaining}s)`;
        if (remaining <= 0) {
          clearInterval(interval);
          isCooldown = false;
          otpBtn.disabled = false;
          otpBtn.textContent = "Get OTP";
        }
      }, 1000);
    }

    function verifyOTP() {
      const enteredOTP = otpInput.value.trim();
      const now = Date.now();

      if (!enteredOTP) return showMessage("‚ùå Please enter the OTP", "text-red-500");

      if (enteredOTP === generatedOTP) {
        if (now - otpTimestamp <= otpValidityTime) {
          showMessage("‚úÖ Login successful!", "text-green-500");
        } else {
          showMessage("‚ö†Ô∏è OTP expired. Request a new one.", "text-yellow-400");
        }
      } else {
        showMessage("‚ùå Invalid OTP", "text-red-500");
      }
    }

    function showMessage(text, colorClass) {
      messageEl.textContent = text;
      messageEl.className = `mt-4 text-center text-sm font-medium ${colorClass}`;
      messageEl.classList.remove("hidden");
    }
  </script>
</body>
</html>
