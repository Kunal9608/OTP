<!DOCTYPE html>
tml lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Image to PDF Converter</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600&display=swap" rel="stylesheet">

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#0f172a',   // Dark blue background
            secondary: '#1e293b', // Slightly lighter blue
            accent: '#3b82f6',    // Bright blue buttons
            dark: '#000000',      // Pure black accents
            success: '#10b981',
            gray: '#cbd5e1'
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif']
          }
        }
      }
    }
  </script>

  <style>
    body {
      <!-- üîí AUTH GUARD: Redirect if not logged in -->
<script>
  (() => {
    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
    const hasSessionUser = sessionStorage.getItem('tempUser') !== null;

    if (!isLoggedIn && !hasSessionUser) {
      window.location.replace('index.html');
    }
  })();
</script>
      font-family: 'Inter', sans-serif;
    }
    .pdf-preview {
      width: 100%;
      max-width: 600px;
      height: 400px;
      border: 1px solid #3b82f6;
      border-radius: 0.5rem;
      margin-top: 1rem;
      background: #000;
    }
    .hidden { display: none !important; }
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #1e40af;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.4s ease;
      z-index: 99;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>
<body class="bg-dark text-white min-h-screen flex flex-col">

  <!-- Navigation Bar -->
  <nav class="bg-primary shadow-lg p-5">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-2xl font-bold text-accent">üìÑ Convertify</h1>
      <button id="logoutBtn" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition duration-200">
        üîê Logout
      </button>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="flex-grow container mx-auto p-6 flex flex-col items-center justify-start space-y-8 mt-10">

    <h2 class="text-3xl font-semibold text-center">üñºÔ∏è Convert Images to PDF</h2>
    <p class="text-gray text-center max-w-xl">
      Upload one or more images (JPG, PNG) and instantly convert them into a single, downloadable PDF file ‚Äî securely in your browser.
    </p>

    <!-- Upload Card -->
    <div class="w-full max-w-lg bg-secondary p-7 rounded-xl shadow-2xl transition-transform hover:scale-[1.01]">
      <label class="block text-sm font-medium mb-3 text-gray-200">üì∑ Select Image(s)</label>
      <input 
        type="file" 
        id="imageInput" 
        accept="image/*" 
        multiple 
        class="w-full file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-accent file:text-white file:font-semibold file:shadow-md hover:file:bg-blue-700"
      />

      <button id="convertBtn" class="mt-5 w-full bg-accent hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 shadow-md hover:shadow-lg">
        ‚ö° Convert to PDF
      </button>
    </div>

    <!-- Result Section -->
    <div id="resultSection" class="hidden w-full max-w-2xl flex flex-col items-center space-y-5 mt-8">
      <h3 class="text-xl font-semibold">üìÑ PDF Preview</h3>
      <iframe id="pdfPreview" class="pdf-preview rounded-lg shadow-inner"></iframe>
      <a id="downloadLink" download="converted.pdf" class="mt-3 bg-success hover:bg-green-700 text-white font-bold py-2.5 px-8 rounded-lg transition duration-200 shadow-md hover:shadow-lg flex items-center gap-2">
        ‚¨áÔ∏è Download PDF
      </a>
    </div>

  </main>

  <!-- Footer -->
  <footer class="bg-primary py-5 text-center text-gray-400 text-sm">
    &copy; 2025 Convertify - Secure & Private Image to PDF Converter
  </footer>

  <!-- Toast Notification -->
  <div id="toast" class="toast">Logged in successfully!</div>

  <!-- External Libraries: jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    // ===== AUTH GUARD: Redirect if not logged in =====
    window.addEventListener('DOMContentLoaded', () => {
      const tempUser = sessionStorage.getItem('tempUser');
      const hardCodedEmail = "kunaldixit.233860@gmail.com";
      const hardCodedPass = "123456";

      // Simulate checking login state
      const urlParams = new URLSearchParams(window.location.search);
      const autoLogin = urlParams.get('login'); // For demo: ?login=true

      if (autoLogin === 'true') {
        // Optional: Auto-login for testing only
        localStorage.setItem('isLoggedIn', 'true');
        window.history.replaceState({}, document.title, window.location.pathname);
      }

      const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true' ||
                         (tempUser || false);

      if (!isLoggedIn) {
        // Redirect to login page
        window.location.href = 'index.html';
      } else {
        showToast("‚úÖ Welcome back! You're logged in.");
      }
    });

    // ===== LOGOUT FUNCTIONALITY =====
    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('isLoggedIn');
      sessionStorage.removeItem('tempUser'); // Optional: clear session data
      showToast('üëã Logged out successfully!');
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 1000);
    });

    // ===== SHOW TOAST NOTIFICATION =====
    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // ===== CONVERT IMAGES TO PDF =====
    const imageInput = document.getElementById('imageInput');
    const convertBtn = document.getElementById('convertBtn');
    const resultSection = document.getElementById('resultSection');
    const pdfPreview = document.getElementById('pdfPreview');
    const downloadLink = document.getElementById('downloadLink');

    let pdfBlobUrl = null;

    convertBtn.addEventListener('click', async () => {
      const files = imageInput.files;
      if (files.length === 0) {
        alert('‚ö†Ô∏è Please select at least one image.');
        return;
      }

      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({
          orientation: 'portrait',
          unit: 'mm',
          format: 'a4'
        });

        const pageHeight = doc.internal.pageSize.height;
        const pageWidth = doc.internal.pageSize.width;
        const margin = 10;
        const maxWidth = pageWidth - 2 * margin;
        const maxHeight = pageHeight - 2 * margin;

        const loadImage = (file) => {
          return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => {
              const img = new Image();
              img.src = e.target.result;
              img.onload = () => {
                let width = img.width;
                let height = img.height;
                const ratio = Math.min(maxWidth / width, maxHeight / height);
                width *= ratio;
                height *= ratio;
                resolve({ img, width, height });
              };
            };
            reader.readAsDataURL(file);
          });
        };

        const imagePromises = Array.from(files).map(loadImage);
        const images = await Promise.all(imagePromises);

        images.forEach(({ img, width, height }, index) => {
          if (index !== 0) doc.addPage();
          const x = (pageWidth - width) / 2;
          const y = (pageHeight - height) / 2;
          doc.addImage(img, 'JPEG', x, y, width, height);
        });

        // Generate PDF blob
        const pdfBytes = doc.output('blob');
        if (pdfBlobUrl) URL.revokeObjectURL(pdfBlobUrl); // Cleanup old
        pdfBlobUrl = URL.createObjectURL(pdfBytes);

        // Show preview and enable download
        pdfPreview.src = pdfBlobUrl;
        downloadLink.href = pdfBlobUrl;
        resultSection.classList.remove('hidden');
        showToast("‚úÖ PDF generated successfully!");
      } catch (err) {
        console.error("Conversion error:", err);
        alert("‚ùå Failed to generate PDF. Try again.");
      }
    });
  // üîí Auth Guard: Check if user is logged in
  window.addEventListener('DOMContentLoaded', () => {
    const savedUser = sessionStorage.getItem('tempUser'); // From signup flow
    const hardCodedEmail = "kunaldixit.233860@gmail.com";
    const hardCodedPass = "123456";
    const emailInput = document.getElementById("signinEmail")?.value.trim();
    const passInput = document.getElementById("signinPassword")?.value.trim();

    // Simulate login check using hardcoded credentials OR saved session
    const isLoggedIn = 
      // Case 1: User signed up & stored in session
      !!savedUser ||
      // Case 2: Using default test credentials (only if already on signin form)
      (emailInput === hardCodedEmail && passInput === hardCodedPass);

    // But since we can't access input fields from dashboard, rely on:
    // - tempUser (signup), OR set a flag like localStorage.isLoggedIn on login

    // ‚úÖ Best approach: Set flag during login ‚Üí check it here
    const loginConfirmed = localStorage.getItem('isLoggedIn') === 'true';

    if (!loginConfirmed && !savedUser) {
      // ‚ùå Not authenticated ‚Üí redirect to login
      window.location.replace('index.html');
    }
    // ‚úÖ Else: stay on dashboard
  });
  </script>
</body>
</html>
