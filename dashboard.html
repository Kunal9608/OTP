<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Image to PDF Converter</title>

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#0f172a', // Dark Blue
            secondary: '#1e293b',
            accent: '#3b82f6',  // Blue highlight
            dark: '#000000'
          }
        }
      }
    }
  </script>
  <style>
    .pdf-preview {
      width: 100%;
      max-width: 600px;
      height: 400px;
      border: 1px solid #3b82f6;
      border-radius: 0.5rem;
      margin-top: 1rem;
    }

    .hidden { display: none !important; }
  </style>
</head>
<body class="bg-dark text-white min-h-screen flex flex-col">

  <!-- Navigation Bar -->
  <nav class="bg-primary shadow-lg p-4">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-2xl font-bold text-accent">Convertify</h1>
      <button id="logoutBtn" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition">
        Logout
      </button>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="flex-grow container mx-auto p-6 flex flex-col items-center justify-start space-y-6 mt-10">

    <h2 class="text-3xl font-semibold mb-4 text-center">üì∑ Convert Images to PDF</h2>
    <p class="text-gray-300 text-center max-w-lg">
      Upload your images (JPG, PNG) and instantly convert them into a downloadable PDF file.
    </p>

    <!-- Upload Section -->
    <div class="w-full max-w-lg bg-secondary p-6 rounded-xl shadow-lg">
      <label class="block text-sm font-medium mb-2">Upload Image(s)</label>
      <input 
        type="file" 
        id="imageInput" 
        accept="image/*" 
        multiple 
        class="w-full file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-accent file:text-white hover:file:bg-blue-600"
      />

      <button id="convertBtn" class="mt-4 w-full bg-accent hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition">
        Convert to PDF
      </button>
    </div>

    <!-- PDF Preview & Download -->
    <div id="resultSection" class="hidden w-full max-w-2xl flex flex-col items-center space-y-4 mt-6">
      <h3 class="text-xl font-semibold">üìÑ PDF Preview</h3>
      <iframe id="pdfPreview" class="pdf-preview bg-black"></iframe>
      <a id="downloadLink" download="converted.pdf" class="mt-2 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg transition">
        ‚¨áÔ∏è Download PDF
      </a>
    </div>

  </main>

  <!-- Footer -->
  <footer class="bg-primary py-4 text-center text-gray-400 text-sm">
    &copy; 2025 Convertify - Secure Image to PDF Converter
  </footer>

  <!-- Client-Side Script (jsPDF + html2canvas) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    // Redirect to login if not authenticated
    window.addEventListener('DOMContentLoaded', () => {
      const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
      if (!isLoggedIn) {
        window.location.href = 'index.html'; // Redirect to login
      }
    });

    // Logout functionality
    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('isLoggedIn');
      window.location.href = 'index.html';
    });

    // Handle image upload and conversion
    const imageInput = document.getElementById('imageInput');
    const convertBtn = document.getElementById('convertBtn');
    const resultSection = document.getElementById('resultSection');
    const pdfPreview = document.getElementById('pdfPreview');
    const downloadLink = document.getElementById('downloadLink');

    let pdfBlobUrl = null;

    convertBtn.addEventListener('click', async () => {
      const files = imageInput.files;
      if (files.length === 0) {
        alert('Please select at least one image.');
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: 'a4'
      });

      const imgPromises = [];
      const pageHeight = doc.internal.pageSize.height;
      const pageWidth = doc.internal.pageSize.width;
      const margin = 10;
      const maxWidth = pageWidth - 2 * margin;
      const maxHeight = pageHeight - 2 * margin;

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const img = new Image();
        const reader = new FileReader();

        const promise = new Promise((resolve) => {
          reader.onload = (e) => {
            img.src = e.target.result;
            img.onload = () => {
              let width = img.width;
              let height = img.height;

              // Calculate aspect ratio scaling
              if (width > maxWidth || height > maxHeight) {
                const ratio = Math.min(maxWidth / width, maxHeight / height);
                width *= ratio;
                height *= ratio;
              }

              resolve({ img, width, height });
            };
          };
          reader.readAsDataURL(file);
        });

        imgPromises.push(promise);
      }

      const images = await Promise.all(imgPromises);

      images.forEach(({ img, width, height }, index) => {
        if (index !== 0) doc.addPage();

        const x = (pageWidth - width) / 2;
        const y = (pageHeight - height) / 2;

        doc.addImage(img, 'JPEG', x, y, width, height);
      });

      // Generate PDF blob
      const pdfBytes = doc.output('blob');
      pdfBlobUrl = URL.createObjectURL(pdfBytes);

      // Show preview
      pdfPreview.src = pdfBlobUrl;
      downloadLink.href = pdfBlobUrl;

      // Show result section
      resultSection.classList.remove('hidden');
    });
  </script>
</body>
</html>
